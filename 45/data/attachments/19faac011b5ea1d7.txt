Create Request is {"resourceType": "Immunization", "contained": [{"resourceType": "Practitioner", "id": "Pract1", "name": [{"family": "Furlong", "given": ["Darren"]}]}, {"resourceType": "Patient", "id": "Pat1", "identifier": [{"system": "https://fhir.nhs.uk/Id/nhs-number", "value": "9000036313"}], "name": [{"family": "JOSHUA", "given": ["HYATT"]}], "gender": "male", "birthDate": "2005-03-14", "address": [{"use": "Home", "type": "Postal", "text": "Validate Obf", "line": ["Notgiven"], "city": "City", "district": "district", "state": "State", "postalCode": "ZZ99 4QZ", "country": "UK", "period": {"start": "2025-03-14", "end": "2033-01-01"}}]}], "extension": [{"url": "https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-VaccinationProcedure", "valueCodeableConcept": {"coding": [{"extension": [{"url": "https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-CodingSCTDescDisplay", "valueString": "Administration of respiratory syncytial virus vaccine"}, {"url": "http://hl7.org/fhir/StructureDefinition/coding-sctdescid", "valueId": "1303503001"}], "system": "http://snomed.info/sct", "code": "1303503001", "display": "Administration of RSV (respiratory syncytial virus) vaccine"}]}}], "identifier": [{"system": "https://supplierABC/identifiers/vacc", "value": "Fail-missing-mandatory-fields-cfbf44fd-803d-4896-a0ba-35113089f878-duplicate"}], "status": "completed", "vaccineCode": {"coding": [{"extension": [{"url": "https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-CodingSCTDescDisplay", "valueString": "Arexvy vaccine powder and suspension for suspension for injection 0.5ml vials"}, {"url": "http://hl7.org/fhir/StructureDefinition/coding-sctdescid", "valueId": "4222311100001107"}], "system": "http://snomed.info/sct", "code": "42223111000001107", "display": "Arexvy vaccine powder and suspension for suspension for injection 0.5ml vials (GlaxoSmithKline UK Ltd)"}]}, "patient": {"reference": "#Pat1", "type": "Patient"}, "manufacturer": {"display": "GlaxoSmithKline UK Ltd"}, "location": {"identifier": {"system": "https://fhir.nhs.uk/Id/ods-organization-code", "value": "X99999"}}, "site": {"coding": [{"extension": [{"url": "https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-CodingSCTDescDisplay", "valueString": "Right upper arm structure (body structure)"}, {"url": "http://hl7.org/fhir/StructureDefinition/coding-sctdescid", "valueId": "36820903"}], "system": "http://snomed.info/sct", "code": "368209003", "display": "Right upper arm structure"}]}, "route": {"coding": [{"extension": [{"url": "https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-CodingSCTDescDisplay", "valueString": "Intramuscular route (qualifier value)"}, {"url": "http://hl7.org/fhir/StructureDefinition/coding-sctdescid", "valueId": "7842100"}], "system": "http://snomed.info/sct", "code": "78421000", "display": "Intramuscular"}]}, "doseQuantity": {"value": 0.3, "unit": "Inhalation - unit of product usage", "system": "http://snomed.info/sct", "code": "2622896019"}, "performer": [{"actor": {"reference": "#Pract1", "type": "Practitioner"}}, {"actor": {"reference": "Organization/B0C4P", "type": "Organization", "identifier": {"system": "https://fhir.nhs.uk/Id/ods-organization-code", "value": "B0C4P", "use": "usual", "type": {"coding": [{"system": "http://terminology.hl7.org/CodeSystem/v2-0203", "code": "123456", "display": "Test display performer"}], "text": "test string performer"}, "period": {"start": "2000-01-01", "end": "2025-01-01"}}}}], "reasonCode": [{"coding": [{"system": "http://snomed.info/sct", "code": "310578008", "display": "Routine immunization schedule"}]}], "protocolApplied": [{"targetDisease": [{"coding": [{"system": "http://snomed.info/sct", "code": "55735004", "display": "Respiratory syncytial virus infection"}]}], "doseNumberPositiveInt": 1}], "occurrenceDateTime": "2026-02-13T16:27:07.888+00:00", "recorded": "2026-02-13T16:27:07.888+00:00", "primarySource": true, "lotNumber": "262089", "expirationDate": "2028-02-13"}
201
201

 Immunization ID is 0fda84d8-3b9d-4c40-9a85-d13d618d197a and Etag is 1 

✅ Pipe-delimited file saved to: /home/runner/work/immunisation-fhir-api/immunisation-fhir-api/tests/e2e_automation/batch_files_directory/RSV_Vaccinations_v5_X8E5B_20260213T16280800.csv
Batch file created: RSV_Vaccinations_v5_X8E5B_20260213T16280800.csv
Upload successful: RSV_Vaccinations_v5_X8E5B_20260213T16280800.csv → immunisation-batch-internal-qa-data-sources
Batch file uploaded to S3: RSV_Vaccinations_v5_X8E5B_20260213T16280800.csv
Waiting for file in archive: s3://immunisation-batch-internal-qa-data-sources/archive/RSV_Vaccinations_v5_X8E5B_20260213T16280800.csv
Still waiting... (0s)
Still waiting... (5s)
Still waiting... (10s)
Still waiting... (15s)
Still waiting... (20s)
Still waiting... (25s)
Still waiting... (30s)
Still waiting... (35s)
Still waiting... (40s)
File found in archive: archive/RSV_Vaccinations_v5_X8E5B_20260213T16280800.csv
Waiting for ACK files starting with 'ack/RSV_Vaccinations_v5_X8E5B_20260213T16280800' in bucket: immunisation-batch-internal-qa-data-destinations
[MODE] Expecting ONLY CSV ACK file
[FOUND] .csv file located: ack/RSV_Vaccinations_v5_X8E5B_20260213T16280800_InfAck_20260213T16280900.csv
[SUCCESS] Loaded .csv file (299 bytes)
[COMPLETE] All expected ACK files received
Waiting for ACK files starting with 'forwardedFile/RSV_Vaccinations_v5_X8E5B_20260213T16280800' in bucket: immunisation-batch-internal-qa-data-destinations
[MODE] Expecting BOTH CSV and JSON ACK files
[FOUND] .csv file located: forwardedFile/RSV_Vaccinations_v5_X8E5B_20260213T16280800_BusAck_20260213T16280900.csv
[SUCCESS] Loaded .csv file (7735 bytes)
[FOUND] .json file located: forwardedFile/RSV_Vaccinations_v5_X8E5B_20260213T16280800_BusAck_20260213T16280900.json
[SUCCESS] Loaded .json file (8999 bytes)
[COMPLETE] All expected ACK files received

 Imms Event response is {'Item': {'Operation': 'CREATE', 'SupplierSystem': 'RAVS', 'Resource': '{"resourceType": "Immunization", "id": "0fda84d8-3b9d-4c40-9a85-d13d618d197a", "contained": [{"resourceType": "Practitioner", "id": "Pract1", "name": [{"family": "Furlong", "given": ["Darren"]}]}, {"resourceType": "Patient", "id": "Pat1", "identifier": [{"system": "https://fhir.nhs.uk/Id/nhs-number", "value": "9000036313"}], "name": [{"family": "JOSHUA", "given": ["HYATT"]}], "gender": "male", "birthDate": "2005-03-14", "address": [{"use": "Home", "type": "Postal", "text": "Validate Obf", "line": ["Notgiven"], "city": "City", "district": "district", "state": "State", "postalCode": "ZZ99 4QZ", "country": "UK", "period": {"start": "2025-03-14", "end": "2033-01-01"}}]}], "extension": [{"url": "https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-VaccinationProcedure", "valueCodeableConcept": {"coding": [{"extension": [{"url": "https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-CodingSCTDescDisplay", "valueString": "Administration of respiratory syncytial virus vaccine"}, {"url": "http://hl7.org/fhir/StructureDefinition/coding-sctdescid", "valueId": "1303503001"}], "system": "http://snomed.info/sct", "code": "1303503001", "display": "Administration of RSV (respiratory syncytial virus) vaccine"}]}}], "identifier": [{"system": "https://supplierABC/identifiers/vacc", "value": "Fail-missing-mandatory-fields-cfbf44fd-803d-4896-a0ba-35113089f878-duplicate"}], "status": "completed", "vaccineCode": {"coding": [{"extension": [{"url": "https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-CodingSCTDescDisplay", "valueString": "Arexvy vaccine powder and suspension for suspension for injection 0.5ml vials"}, {"url": "http://hl7.org/fhir/StructureDefinition/coding-sctdescid", "valueId": "4222311100001107"}], "system": "http://snomed.info/sct", "code": "42223111000001107", "display": "Arexvy vaccine powder and suspension for suspension for injection 0.5ml vials (GlaxoSmithKline UK Ltd)"}]}, "patient": {"reference": "#Pat1", "type": "Patient"}, "occurrenceDateTime": "2026-02-13T16:27:07.888000+00:00", "recorded": "2026-02-13T16:27:07.888000+00:00", "primarySource": true, "location": {"identifier": {"system": "https://fhir.nhs.uk/Id/ods-organization-code", "value": "X99999"}}, "manufacturer": {"display": "GlaxoSmithKline UK Ltd"}, "lotNumber": "262089", "expirationDate": "2028-02-13", "site": {"coding": [{"extension": [{"url": "https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-CodingSCTDescDisplay", "valueString": "Right upper arm structure (body structure)"}, {"url": "http://hl7.org/fhir/StructureDefinition/coding-sctdescid", "valueId": "36820903"}], "system": "http://snomed.info/sct", "code": "368209003", "display": "Right upper arm structure"}]}, "route": {"coding": [{"extension": [{"url": "https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-CodingSCTDescDisplay", "valueString": "Intramuscular route (qualifier value)"}, {"url": "http://hl7.org/fhir/StructureDefinition/coding-sctdescid", "valueId": "7842100"}], "system": "http://snomed.info/sct", "code": "78421000", "display": "Intramuscular"}]}, "doseQuantity": {"value": 0.3, "unit": "Inhalation - unit of product usage", "system": "http://snomed.info/sct", "code": "2622896019"}, "performer": [{"actor": {"reference": "#Pract1", "type": "Practitioner"}}, {"actor": {"reference": "Organization/B0C4P", "type": "Organization", "identifier": {"use": "usual", "type": {"coding": [{"system": "http://terminology.hl7.org/CodeSystem/v2-0203", "code": "123456", "display": "Test display performer"}], "text": "test string performer"}, "system": "https://fhir.nhs.uk/Id/ods-organization-code", "value": "B0C4P", "period": {"start": "2000-01-01", "end": "2025-01-01"}}}}], "reasonCode": [{"coding": [{"system": "http://snomed.info/sct", "code": "310578008", "display": "Routine immunization schedule"}]}], "protocolApplied": [{"targetDisease": [{"coding": [{"system": "http://snomed.info/sct", "code": "55735004", "display": "Respiratory syncytial virus infection"}]}], "doseNumberPositiveInt": 1}]}', 'Version': Decimal('1'), 'IdentifierPK': 'https://supplierABC/identifiers/vacc#Fail-missing-mandatory-fields-cfbf44fd-803d-4896-a0ba-35113089f878-duplicate', 'PatientSK': 'RSV#0fda84d8-3b9d-4c40-9a85-d13d618d197a', 'PK': 'Immunization#0fda84d8-3b9d-4c40-9a85-d13d618d197a', 'PatientPK': 'Patient#9000036313'}, 'ResponseMetadata': {'RequestId': 'VBRRULJR5N0GGN7E6VHK0DB87RVV4KQNSO5AEMVJF66Q9ASUAAJG', 'HTTPStatusCode': 200, 'HTTPHeaders': {'server': 'Server', 'date': 'Fri, 13 Feb 2026 16:28:56 GMT', 'content-type': 'application/x-amz-json-1.0', 'content-length': '4863', 'connection': 'keep-alive', 'x-amzn-requestid': 'VBRRULJR5N0GGN7E6VHK0DB87RVV4KQNSO5AEMVJF66Q9ASUAAJG', 'x-amz-crc32': '3609227301'}, 'RetryAttempts': 0}} 

Attempt 1: Found 1 items

Found Immunization Delta items for ImmsID=0fda84d8-3b9d-4c40-9a85-d13d618d197a


 Delete Request is https://internal-qa.api.service.nhs.uk/immunisation-fhir-api/FHIR/R4/Immunization/0fda84d8-3b9d-4c40-9a85-d13d618d197a
 No IMMS_ID column or no values present as test failed due to as exception — skipping delete cleanup.
