✅ Pipe-delimited file saved to: /home/runner/work/immunisation-fhir-api/immunisation-fhir-api/tests/e2e_automation/batch_files_directory/MENACWY_Vaccinations_v5_YGA_20260206T17414900.csv
Batch file created: MENACWY_Vaccinations_v5_YGA_20260206T17414900.csv
Upload successful: MENACWY_Vaccinations_v5_YGA_20260206T17414900.csv → immunisation-batch-pr-1168-data-sources
Batch file uploaded to S3: MENACWY_Vaccinations_v5_YGA_20260206T17414900.csv
Waiting for file in archive: s3://immunisation-batch-pr-1168-data-sources/archive/MENACWY_Vaccinations_v5_YGA_20260206T17414900.csv
Still waiting... (0s)
Still waiting... (5s)
Still waiting... (10s)
Still waiting... (15s)
Still waiting... (20s)
Still waiting... (25s)
Still waiting... (30s)
Still waiting... (35s)
Still waiting... (40s)
Still waiting... (45s)
File found in archive: archive/MENACWY_Vaccinations_v5_YGA_20260206T17414900.csv
Waiting for ACK files starting with 'ack/MENACWY_Vaccinations_v5_YGA_20260206T17414900' in bucket: immunisation-batch-pr-1168-data-destinations
[MODE] Expecting ONLY CSV ACK file
[FOUND] .csv file located: ack/MENACWY_Vaccinations_v5_YGA_20260206T17414900_InfAck_20260206T17415000.csv
[SUCCESS] Loaded .csv file (299 bytes)
[COMPLETE] All expected ACK files received
Waiting for ACK files starting with 'forwardedFile/MENACWY_Vaccinations_v5_YGA_20260206T17414900' in bucket: immunisation-batch-pr-1168-data-destinations
[MODE] Expecting BOTH CSV and JSON ACK files
[FOUND] .csv file located: forwardedFile/MENACWY_Vaccinations_v5_YGA_20260206T17414900_BusAck_20260206T17415000.csv
[SUCCESS] Loaded .csv file (208 bytes)
[FOUND] .json file located: forwardedFile/MENACWY_Vaccinations_v5_YGA_20260206T17414900_BusAck_20260206T17415000.json
[SUCCESS] Loaded .json file (436 bytes)
[COMPLETE] All expected ACK files received
No rows found in BUS ACK file for successful records
Attempt 1: Found 1 items

Found Audit detail for filename=MENACWY_Vaccinations_v5_YGA_20260206T17414900.csv


 Imms Event response is {'Items': [{'Resource': '{"resourceType": "Immunization", "status": "completed", "protocolApplied": [{"targetDisease": [{"coding": [{"system": "http://snomed.info/sct", "code": "23511006", "display": "Meningococcal infectious disease"}]}], "doseNumberPositiveInt": 1}], "reasonCode": [{"coding": [{"system": "http://snomed.info/sct", "code": "443684005"}]}], "recorded": "2026-02-06", "identifier": [{"value": "Action_flag_NEW-20260206T174149", "system": "https://fhir.nhs.uk/Id/Automation-vaccine-administered-event-uk"}], "patient": {"reference": "#Patient1"}, "contained": [{"id": "Patient1", "resourceType": "Patient", "birthDate": "2009-09-23", "gender": "male", "address": [{"postalCode": "ZZ99 3AZ"}], "identifier": [{"system": "https://fhir.nhs.uk/Id/nhs-number", "value": "5993356731"}], "name": [{"family": "RICK", "given": ["POUROS"]}]}, {"resourceType": "Practitioner", "id": "Practitioner1", "name": [{"family": "Tests", "given": ["Automation"]}]}], "vaccineCode": {"coding": [{"system": "http://snomed.info/sct", "code": "39779611000001104", "display": "MenQuadfi vaccine solution for injection 0.5ml vials (Sanofi) (product)"}]}, "manufacturer": {"display": "Sanofi"}, "expirationDate": "2026-02-06", "lotNumber": "581519", "extension": [{"url": "https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-VaccinationProcedure", "valueCodeableConcept": {"coding": [{"system": "http://snomed.info/sct", "code": "871874000", "display": "Administration of vaccine product containing only Neisseria meningitidis serogroup A, C, W135 and Y antigens (procedure)"}]}}], "occurrenceDateTime": "2026-02-06T17:40:59+00:00", "primarySource": true, "site": {"coding": [{"system": "http://snomed.info/sct", "code": "368208006", "display": "Left upper arm structure"}]}, "route": {"coding": [{"system": "http://snomed.info/sct", "code": "34206005", "display": "Subcutaneous route (qualifier value)"}]}, "doseQuantity": {"value": 0.5, "unit": "millilitre", "system": "http://snomed.info/sct", "code": "ml"}, "performer": [{"actor": {"type": "Organization", "identifier": {"system": "https://fhir.nhs.uk/Id/ods-organization-code", "value": "X99999"}}}, {"actor": {"reference": "#Practitioner1"}}], "location": {"identifier": {"value": "X99999", "system": "https://fhir.nhs.uk/Id/ods-organization-code"}}, "id": "aeb612d8-19ac-439e-8088-1da8f31ce33b"}', 'IdentifierPK': 'https://fhir.nhs.uk/Id/Automation-vaccine-administered-event-uk#Action_flag_NEW-20260206T174149', 'Operation': 'CREATE', 'PatientSK': 'MENACWY#aeb612d8-19ac-439e-8088-1da8f31ce33b', 'PK': 'Immunization#aeb612d8-19ac-439e-8088-1da8f31ce33b', 'SupplierSystem': 'TPP', 'PatientPK': 'Patient#5993356731', 'Version': Decimal('1')}], 'Count': 1, 'ScannedCount': 1, 'ResponseMetadata': {'RequestId': '7DKAB59F2P59133AI1VAQIH4QJVV4KQNSO5AEMVJF66Q9ASUAAJG', 'HTTPStatusCode': 200, 'HTTPHeaders': {'server': 'Server', 'date': 'Fri, 06 Feb 2026 17:42:44 GMT', 'content-type': 'application/x-amz-json-1.0', 'content-length': '3016', 'connection': 'keep-alive', 'x-amzn-requestid': '7DKAB59F2P59133AI1VAQIH4QJVV4KQNSO5AEMVJF66Q9ASUAAJG', 'x-amz-crc32': '3901029333'}, 'RetryAttempts': 0}} 


 Imms Event response is {'Items': [{'Operation': 'CREATE', 'SupplierSystem': 'TPP', 'Version': Decimal('1'), 'Resource': '{"resourceType": "Immunization", "status": "completed", "protocolApplied": [{"targetDisease": [{"coding": [{"system": "http://snomed.info/sct", "code": "23511006", "display": "Meningococcal infectious disease"}]}], "doseNumberPositiveInt": 1}], "reasonCode": [{"coding": [{"system": "http://snomed.info/sct", "code": "443684005"}]}], "recorded": "2026-02-06", "identifier": [{"value": "Action_flag_New-20260206T174149", "system": "https://fhir.nhs.uk/Id/Automation-vaccine-administered-event-uk"}], "patient": {"reference": "#Patient1"}, "contained": [{"id": "Patient1", "resourceType": "Patient", "birthDate": "2003-02-05", "gender": "female", "address": [{"postalCode": "LA9 7EW"}], "identifier": [{"system": "https://fhir.nhs.uk/Id/nhs-number", "value": "9490124648"}], "name": [{"family": "ELSIE", "given": ["PRCE"]}]}, {"resourceType": "Practitioner", "id": "Practitioner1", "name": [{"family": "Tests", "given": ["Automation"]}]}], "vaccineCode": {"coding": [{"system": "http://snomed.info/sct", "code": "17188711000001105", "display": "Menveo vaccine powder and solvent for solution for injection 0.5ml vials (Novartis Vaccines and Diagnostics Ltd) (product)"}]}, "manufacturer": {"display": "Novartis Vaccines and Diagnostics Ltd"}, "expirationDate": "2026-02-06", "lotNumber": "573892", "extension": [{"url": "https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-VaccinationProcedure", "valueCodeableConcept": {"coding": [{"system": "http://snomed.info/sct", "code": "871874000", "display": "Administration of vaccine product containing only Neisseria meningitidis serogroup A, C, W135 and Y antigens (procedure)"}]}}], "occurrenceDateTime": "2026-02-06T17:40:59+00:00", "primarySource": true, "site": {"coding": [{"system": "http://snomed.info/sct", "code": "368209003", "display": "Right upper arm structure"}]}, "route": {"coding": [{"system": "http://snomed.info/sct", "code": "34206005", "display": "Subcutaneous route (qualifier value)"}]}, "doseQuantity": {"value": 0.5, "unit": "millilitre", "system": "http://snomed.info/sct", "code": "ml"}, "performer": [{"actor": {"type": "Organization", "identifier": {"system": "https://fhir.nhs.uk/Id/ods-organization-code", "value": "X99999"}}}, {"actor": {"reference": "#Practitioner1"}}], "location": {"identifier": {"value": "X99999", "system": "https://fhir.nhs.uk/Id/ods-organization-code"}}, "id": "bd29b1ed-b37e-4e53-a406-140b5053ca5e"}', 'PatientSK': 'MENACWY#bd29b1ed-b37e-4e53-a406-140b5053ca5e', 'PatientPK': 'Patient#9490124648', 'PK': 'Immunization#bd29b1ed-b37e-4e53-a406-140b5053ca5e', 'IdentifierPK': 'https://fhir.nhs.uk/Id/Automation-vaccine-administered-event-uk#Action_flag_New-20260206T174149'}], 'Count': 1, 'ScannedCount': 1, 'ResponseMetadata': {'RequestId': 'DS0AFIJLRFOPL44SBMF2E1KR33VV4KQNSO5AEMVJF66Q9ASUAAJG', 'HTTPStatusCode': 200, 'HTTPHeaders': {'server': 'Server', 'date': 'Fri, 06 Feb 2026 17:42:45 GMT', 'content-type': 'application/x-amz-json-1.0', 'content-length': '3099', 'connection': 'keep-alive', 'x-amzn-requestid': 'DS0AFIJLRFOPL44SBMF2E1KR33VV4KQNSO5AEMVJF66Q9ASUAAJG', 'x-amz-crc32': '3350251243'}, 'RetryAttempts': 0}} 


 Imms Event response is {'Items': [{'Operation': 'CREATE', 'PK': 'Immunization#f006e76a-8631-42b7-8092-f16038d4049a', 'PatientPK': 'Patient#9734075160', 'IdentifierPK': 'https://fhir.nhs.uk/Id/Automation-vaccine-administered-event-uk#Action_flag_new-20260206T174149', 'Version': Decimal('1'), 'SupplierSystem': 'TPP', 'PatientSK': 'MENACWY#f006e76a-8631-42b7-8092-f16038d4049a', 'Resource': '{"resourceType": "Immunization", "status": "completed", "protocolApplied": [{"targetDisease": [{"coding": [{"system": "http://snomed.info/sct", "code": "23511006", "display": "Meningococcal infectious disease"}]}], "doseNumberPositiveInt": 1}], "reasonCode": [{"coding": [{"system": "http://snomed.info/sct", "code": "443684005"}]}], "recorded": "2026-02-06", "identifier": [{"value": "Action_flag_new-20260206T174149", "system": "https://fhir.nhs.uk/Id/Automation-vaccine-administered-event-uk"}], "patient": {"reference": "#Patient1"}, "contained": [{"id": "Patient1", "resourceType": "Patient", "birthDate": "2009-09-23", "gender": "female", "address": [{"postalCode": "LS7 4QU"}], "identifier": [{"system": "https://fhir.nhs.uk/Id/nhs-number", "value": "9734075160"}], "name": [{"family": "YVETTE", "given": ["MEGINN"]}]}, {"resourceType": "Practitioner", "id": "Practitioner1", "name": [{"family": "Tests", "given": ["Automation"]}]}], "vaccineCode": {"coding": [{"system": "http://snomed.info/sct", "code": "20517811000001104", "display": "Nimenrix vaccine powder and solvent for solution for injection 0.5ml pre-filled syringes (GlaxoSmithKline UK Ltd) (product)"}]}, "manufacturer": {"display": "GlaxoSmithKline UK Ltd"}, "expirationDate": "2026-02-06", "lotNumber": "334605", "extension": [{"url": "https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-VaccinationProcedure", "valueCodeableConcept": {"coding": [{"system": "http://snomed.info/sct", "code": "871874000", "display": "Administration of vaccine product containing only Neisseria meningitidis serogroup A, C, W135 and Y antigens (procedure)"}]}}], "occurrenceDateTime": "2026-02-06T17:40:59+00:00", "primarySource": true, "site": {"coding": [{"system": "http://snomed.info/sct", "code": "368208006", "display": "Left upper arm structure"}]}, "route": {"coding": [{"system": "http://snomed.info/sct", "code": "78421000", "display": "Intramuscular"}]}, "doseQuantity": {"value": 0.5, "unit": "millilitre", "system": "http://snomed.info/sct", "code": "ml"}, "performer": [{"actor": {"type": "Organization", "identifier": {"system": "https://fhir.nhs.uk/Id/ods-organization-code", "value": "X99999"}}}, {"actor": {"reference": "#Practitioner1"}}], "location": {"identifier": {"value": "X99999", "system": "https://fhir.nhs.uk/Id/ods-organization-code"}}, "id": "f006e76a-8631-42b7-8092-f16038d4049a"}'}], 'Count': 1, 'ScannedCount': 1, 'ResponseMetadata': {'RequestId': '8QPKD3INBGMKFS3BTCLK09GQB3VV4KQNSO5AEMVJF66Q9ASUAAJG', 'HTTPStatusCode': 200, 'HTTPHeaders': {'server': 'Server', 'date': 'Fri, 06 Feb 2026 17:42:45 GMT', 'content-type': 'application/x-amz-json-1.0', 'content-length': '3064', 'connection': 'keep-alive', 'x-amzn-requestid': '8QPKD3INBGMKFS3BTCLK09GQB3VV4KQNSO5AEMVJF66Q9ASUAAJG', 'x-amz-crc32': '3643770714'}, 'RetryAttempts': 0}} 


 Imms Event response is {'Items': [{'Resource': '{"resourceType": "Immunization", "status": "completed", "protocolApplied": [{"targetDisease": [{"coding": [{"system": "http://snomed.info/sct", "code": "23511006", "display": "Meningococcal infectious disease"}]}], "doseNumberPositiveInt": 1}], "reasonCode": [{"coding": [{"system": "http://snomed.info/sct", "code": "443684005"}]}], "recorded": "2026-02-06", "identifier": [{"value": "Action_flag_nEw-20260206T174149", "system": "https://fhir.nhs.uk/Id/Automation-vaccine-administered-event-uk"}], "patient": {"reference": "#Patient1"}, "contained": [{"id": "Patient1", "resourceType": "Patient", "birthDate": "2002-08-12", "gender": "male", "address": [{"postalCode": "NG20 9ET"}], "identifier": [{"system": "https://fhir.nhs.uk/Id/nhs-number", "value": "9735023563"}], "name": [{"family": "VERNON", "given": ["AQZ-MAR-PDS-ALPHA-ZERO"]}]}, {"resourceType": "Practitioner", "id": "Practitioner1", "name": [{"family": "Tests", "given": ["Automation"]}]}], "vaccineCode": {"coding": [{"system": "http://snomed.info/sct", "code": "17188711000001105", "display": "Menveo vaccine powder and solvent for solution for injection 0.5ml vials (Novartis Vaccines and Diagnostics Ltd) (product)"}]}, "manufacturer": {"display": "Novartis Vaccines and Diagnostics Ltd"}, "expirationDate": "2026-02-06", "lotNumber": "275264", "extension": [{"url": "https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-VaccinationProcedure", "valueCodeableConcept": {"coding": [{"system": "http://snomed.info/sct", "code": "871874000", "display": "Administration of vaccine product containing only Neisseria meningitidis serogroup A, C, W135 and Y antigens (procedure)"}]}}], "occurrenceDateTime": "2026-02-06T17:40:59+00:00", "primarySource": true, "site": {"coding": [{"system": "http://snomed.info/sct", "code": "368208006", "display": "Left upper arm structure"}]}, "route": {"coding": [{"system": "http://snomed.info/sct", "code": "78421000", "display": "Intramuscular"}]}, "doseQuantity": {"value": 0.5, "unit": "millilitre", "system": "http://snomed.info/sct", "code": "ml"}, "performer": [{"actor": {"type": "Organization", "identifier": {"system": "https://fhir.nhs.uk/Id/ods-organization-code", "value": "X99999"}}}, {"actor": {"reference": "#Practitioner1"}}], "location": {"identifier": {"value": "X99999", "system": "https://fhir.nhs.uk/Id/ods-organization-code"}}, "id": "470ec624-aac2-4729-9e52-1bfdb1dea689"}', 'IdentifierPK': 'https://fhir.nhs.uk/Id/Automation-vaccine-administered-event-uk#Action_flag_nEw-20260206T174149', 'PatientSK': 'MENACWY#470ec624-aac2-4729-9e52-1bfdb1dea689', 'SupplierSystem': 'TPP', 'Version': Decimal('1'), 'PatientPK': 'Patient#9735023563', 'PK': 'Immunization#470ec624-aac2-4729-9e52-1bfdb1dea689', 'Operation': 'CREATE'}], 'Count': 1, 'ScannedCount': 1, 'ResponseMetadata': {'RequestId': '2VK7FG7G41NS4EMSK59L4TS5QNVV4KQNSO5AEMVJF66Q9ASUAAJG', 'HTTPStatusCode': 200, 'HTTPHeaders': {'server': 'Server', 'date': 'Fri, 06 Feb 2026 17:42:46 GMT', 'content-type': 'application/x-amz-json-1.0', 'content-length': '3093', 'connection': 'keep-alive', 'x-amzn-requestid': '2VK7FG7G41NS4EMSK59L4TS5QNVV4KQNSO5AEMVJF66Q9ASUAAJG', 'x-amz-crc32': '2709194833'}, 'RetryAttempts': 0}} 

Attempt 1: Found 1 items

Found Immunization Delta items for ImmsID=470ec624-aac2-4729-9e52-1bfdb1dea689

Attempt 1: Found 1 items

Found Immunization Delta items for ImmsID=aeb612d8-19ac-439e-8088-1da8f31ce33b

Attempt 1: Found 1 items

Found Immunization Delta items for ImmsID=bd29b1ed-b37e-4e53-a406-140b5053ca5e

Attempt 1: Found 1 items

Found Immunization Delta items for ImmsID=f006e76a-8631-42b7-8092-f16038d4049a

Sending DELETE request to: https://internal-dev.api.service.nhs.uk/immunisation-fhir-api/FHIR/R4-pr-1168/Immunization/aeb612d8-19ac-439e-8088-1da8f31ce33b
Sending DELETE request to: https://internal-dev.api.service.nhs.uk/immunisation-fhir-api/FHIR/R4-pr-1168/Immunization/bd29b1ed-b37e-4e53-a406-140b5053ca5e
Sending DELETE request to: https://internal-dev.api.service.nhs.uk/immunisation-fhir-api/FHIR/R4-pr-1168/Immunization/f006e76a-8631-42b7-8092-f16038d4049a
Sending DELETE request to: https://internal-dev.api.service.nhs.uk/immunisation-fhir-api/FHIR/R4-pr-1168/Immunization/470ec624-aac2-4729-9e52-1bfdb1dea689
All IMMS_IDs deleted successfully.
