Create Request is {"resourceType": "Immunization", "contained": [{"resourceType": "Practitioner", "id": "Pract1", "name": [{"family": "Furlong", "given": ["Darren"]}]}, {"resourceType": "Patient", "id": "Pat1", "identifier": [{"system": "https://fhir.nhs.uk/Id/nhs-number", "value": "9000191467"}], "name": [{"family": "HARLEY", "given": ["GOODMAN"]}], "gender": "male", "birthDate": "2008-09-11", "address": [{"use": "Home", "type": "Postal", "text": "Validate Obf", "line": ["Notgiven"], "city": "City", "district": "district", "state": "State", "postalCode": "ZZ99 4QZ", "country": "UK", "period": {"start": "2025-03-26", "end": "2033-01-01"}}]}], "extension": [{"url": "https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-VaccinationProcedure", "valueCodeableConcept": {"coding": [{"extension": [{"url": "https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-CodingSCTDescDisplay", "valueString": "Administration of respiratory syncytial virus vaccine"}, {"url": "http://hl7.org/fhir/StructureDefinition/coding-sctdescid", "valueId": "1303503001"}], "system": "http://snomed.info/sct", "code": "1303503001", "display": "Administration of RSV (respiratory syncytial virus) vaccine"}]}}], "identifier": [{"system": "https://supplierABC/identifiers/vacc", "value": "Fail-missing-mandatory-fields-89159793-104a-47d7-b251-bfa34acaf299-duplicate"}], "status": "completed", "vaccineCode": {"coding": [{"extension": [{"url": "https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-CodingSCTDescDisplay", "valueString": "Arexvy vaccine powder and suspension for suspension for injection 0.5ml vials"}, {"url": "http://hl7.org/fhir/StructureDefinition/coding-sctdescid", "valueId": "4222311100001107"}], "system": "http://snomed.info/sct", "code": "42223111000001107", "display": "Arexvy vaccine powder and suspension for suspension for injection 0.5ml vials (GlaxoSmithKline UK Ltd)"}]}, "patient": {"reference": "#Pat1", "type": "Patient"}, "manufacturer": {"display": "GlaxoSmithKline UK Ltd"}, "location": {"identifier": {"system": "https://fhir.nhs.uk/Id/ods-organization-code", "value": "X99999"}}, "site": {"coding": [{"extension": [{"url": "https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-CodingSCTDescDisplay", "valueString": "Left upper arm structure (body structure)"}, {"url": "http://hl7.org/fhir/StructureDefinition/coding-sctdescid", "valueId": "36820006"}], "system": "http://snomed.info/sct", "code": "368208006", "display": "Left upper arm structure"}]}, "route": {"coding": [{"extension": [{"url": "https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-CodingSCTDescDisplay", "valueString": "Subcutaneous route (qualifier value)"}, {"url": "http://hl7.org/fhir/StructureDefinition/coding-sctdescid", "valueId": "3420605"}], "system": "http://snomed.info/sct", "code": "34206005", "display": "Subcutaneous route (qualifier value)"}]}, "doseQuantity": {"value": 0.3, "unit": "Inhalation - unit of product usage", "system": "http://snomed.info/sct", "code": "2622896019"}, "performer": [{"actor": {"reference": "#Pract1", "type": "Practitioner"}}, {"actor": {"reference": "Organization/B0C4P", "type": "Organization", "identifier": {"system": "https://fhir.nhs.uk/Id/ods-organization-code", "value": "B0C4P", "use": "usual", "type": {"coding": [{"system": "http://terminology.hl7.org/CodeSystem/v2-0203", "code": "123456", "display": "Test display performer"}], "text": "test string performer"}, "period": {"start": "2000-01-01", "end": "2025-01-01"}}}}], "reasonCode": [{"coding": [{"system": "http://snomed.info/sct", "code": "443684005", "display": "Disease outbreak (event)"}]}], "protocolApplied": [{"targetDisease": [{"coding": [{"system": "http://snomed.info/sct", "code": "55735004", "display": "Respiratory syncytial virus infection"}]}], "doseNumberPositiveInt": 1}], "occurrenceDateTime": "2026-02-10T19:29:25.207+00:00", "recorded": "2026-02-10T19:29:25.207+00:00", "primarySource": true, "lotNumber": "933102", "expirationDate": "2028-02-10"}
201
201

 Immunization ID is 23b46b63-c619-4f7e-aacd-c0ca46b49098 and Etag is 1 

✅ Pipe-delimited file saved to: /home/runner/work/immunisation-fhir-api/immunisation-fhir-api/tests/e2e_automation/batch_files_directory/RSV_Vaccinations_v5_X8E5B_20260210T19302500.csv
Batch file created: RSV_Vaccinations_v5_X8E5B_20260210T19302500.csv
Upload successful: RSV_Vaccinations_v5_X8E5B_20260210T19302500.csv → immunisation-batch-internal-qa-data-sources
Batch file uploaded to S3: RSV_Vaccinations_v5_X8E5B_20260210T19302500.csv
Waiting for file in archive: s3://immunisation-batch-internal-qa-data-sources/archive/RSV_Vaccinations_v5_X8E5B_20260210T19302500.csv
Still waiting... (0s)
Still waiting... (5s)
Still waiting... (10s)
Still waiting... (15s)
Still waiting... (20s)
Still waiting... (25s)
Still waiting... (30s)
Still waiting... (35s)
Still waiting... (40s)
File found in archive: archive/RSV_Vaccinations_v5_X8E5B_20260210T19302500.csv
Waiting for ACK files starting with 'ack/RSV_Vaccinations_v5_X8E5B_20260210T19302500' in bucket: immunisation-batch-internal-qa-data-destinations
[MODE] Expecting ONLY CSV ACK file
[FOUND] .csv file located: ack/RSV_Vaccinations_v5_X8E5B_20260210T19302500_InfAck_20260210T19302600.csv
[SUCCESS] Loaded .csv file (299 bytes)
[COMPLETE] All expected ACK files received
Waiting for ACK files starting with 'forwardedFile/RSV_Vaccinations_v5_X8E5B_20260210T19302500' in bucket: immunisation-batch-internal-qa-data-destinations
[MODE] Expecting BOTH CSV and JSON ACK files
[FOUND] .csv file located: forwardedFile/RSV_Vaccinations_v5_X8E5B_20260210T19302500_BusAck_20260210T19302600.csv
[SUCCESS] Loaded .csv file (7389 bytes)
[FOUND] .json file located: forwardedFile/RSV_Vaccinations_v5_X8E5B_20260210T19302500_BusAck_20260210T19302600.json
[SUCCESS] Loaded .json file (8604 bytes)
[COMPLETE] All expected ACK files received

 Imms Event response is {'Item': {'Operation': 'CREATE', 'SupplierSystem': 'RAVS', 'Resource': '{"resourceType": "Immunization", "id": "23b46b63-c619-4f7e-aacd-c0ca46b49098", "contained": [{"resourceType": "Practitioner", "id": "Pract1", "name": [{"family": "Furlong", "given": ["Darren"]}]}, {"resourceType": "Patient", "id": "Pat1", "identifier": [{"system": "https://fhir.nhs.uk/Id/nhs-number", "value": "9000191467"}], "name": [{"family": "HARLEY", "given": ["GOODMAN"]}], "gender": "male", "birthDate": "2008-09-11", "address": [{"use": "Home", "type": "Postal", "text": "Validate Obf", "line": ["Notgiven"], "city": "City", "district": "district", "state": "State", "postalCode": "ZZ99 4QZ", "country": "UK", "period": {"start": "2025-03-26", "end": "2033-01-01"}}]}], "extension": [{"url": "https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-VaccinationProcedure", "valueCodeableConcept": {"coding": [{"extension": [{"url": "https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-CodingSCTDescDisplay", "valueString": "Administration of respiratory syncytial virus vaccine"}, {"url": "http://hl7.org/fhir/StructureDefinition/coding-sctdescid", "valueId": "1303503001"}], "system": "http://snomed.info/sct", "code": "1303503001", "display": "Administration of RSV (respiratory syncytial virus) vaccine"}]}}], "identifier": [{"system": "https://supplierABC/identifiers/vacc", "value": "Fail-missing-mandatory-fields-89159793-104a-47d7-b251-bfa34acaf299-duplicate"}], "status": "completed", "vaccineCode": {"coding": [{"extension": [{"url": "https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-CodingSCTDescDisplay", "valueString": "Arexvy vaccine powder and suspension for suspension for injection 0.5ml vials"}, {"url": "http://hl7.org/fhir/StructureDefinition/coding-sctdescid", "valueId": "4222311100001107"}], "system": "http://snomed.info/sct", "code": "42223111000001107", "display": "Arexvy vaccine powder and suspension for suspension for injection 0.5ml vials (GlaxoSmithKline UK Ltd)"}]}, "patient": {"reference": "#Pat1", "type": "Patient"}, "occurrenceDateTime": "2026-02-10T19:29:25.207000+00:00", "recorded": "2026-02-10T19:29:25.207000+00:00", "primarySource": true, "location": {"identifier": {"system": "https://fhir.nhs.uk/Id/ods-organization-code", "value": "X99999"}}, "manufacturer": {"display": "GlaxoSmithKline UK Ltd"}, "lotNumber": "933102", "expirationDate": "2028-02-10", "site": {"coding": [{"extension": [{"url": "https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-CodingSCTDescDisplay", "valueString": "Left upper arm structure (body structure)"}, {"url": "http://hl7.org/fhir/StructureDefinition/coding-sctdescid", "valueId": "36820006"}], "system": "http://snomed.info/sct", "code": "368208006", "display": "Left upper arm structure"}]}, "route": {"coding": [{"extension": [{"url": "https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-CodingSCTDescDisplay", "valueString": "Subcutaneous route (qualifier value)"}, {"url": "http://hl7.org/fhir/StructureDefinition/coding-sctdescid", "valueId": "3420605"}], "system": "http://snomed.info/sct", "code": "34206005", "display": "Subcutaneous route (qualifier value)"}]}, "doseQuantity": {"value": 0.3, "unit": "Inhalation - unit of product usage", "system": "http://snomed.info/sct", "code": "2622896019"}, "performer": [{"actor": {"reference": "#Pract1", "type": "Practitioner"}}, {"actor": {"reference": "Organization/B0C4P", "type": "Organization", "identifier": {"use": "usual", "type": {"coding": [{"system": "http://terminology.hl7.org/CodeSystem/v2-0203", "code": "123456", "display": "Test display performer"}], "text": "test string performer"}, "system": "https://fhir.nhs.uk/Id/ods-organization-code", "value": "B0C4P", "period": {"start": "2000-01-01", "end": "2025-01-01"}}}}], "reasonCode": [{"coding": [{"system": "http://snomed.info/sct", "code": "443684005", "display": "Disease outbreak (event)"}]}], "protocolApplied": [{"targetDisease": [{"coding": [{"system": "http://snomed.info/sct", "code": "55735004", "display": "Respiratory syncytial virus infection"}]}], "doseNumberPositiveInt": 1}]}', 'Version': Decimal('1'), 'IdentifierPK': 'https://supplierABC/identifiers/vacc#Fail-missing-mandatory-fields-89159793-104a-47d7-b251-bfa34acaf299-duplicate', 'PatientSK': 'RSV#23b46b63-c619-4f7e-aacd-c0ca46b49098', 'PK': 'Immunization#23b46b63-c619-4f7e-aacd-c0ca46b49098', 'PatientPK': 'Patient#9000191467'}, 'ResponseMetadata': {'RequestId': '1UD0JRUE02PUR4VJRO2EJII0DNVV4KQNSO5AEMVJF66Q9ASUAAJG', 'HTTPStatusCode': 200, 'HTTPHeaders': {'server': 'Server', 'date': 'Tue, 10 Feb 2026 19:31:13 GMT', 'content-type': 'application/x-amz-json-1.0', 'content-length': '4880', 'connection': 'keep-alive', 'x-amzn-requestid': '1UD0JRUE02PUR4VJRO2EJII0DNVV4KQNSO5AEMVJF66Q9ASUAAJG', 'x-amz-crc32': '122728940'}, 'RetryAttempts': 0}} 

Attempt 1: Found 1 items

Found Immunization Delta items for ImmsID=23b46b63-c619-4f7e-aacd-c0ca46b49098


 Delete Request is https://internal-qa.api.service.nhs.uk/immunisation-fhir-api/FHIR/R4/Immunization/23b46b63-c619-4f7e-aacd-c0ca46b49098
 No IMMS_ID column or no values present as test failed due to as exception — skipping delete cleanup.
