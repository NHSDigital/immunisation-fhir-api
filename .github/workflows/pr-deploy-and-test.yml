name: PR Deploy and Test

on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  deploy-pr-envs:
    strategy:
      matrix:
        apigee_environment_name: [internal-dev, internal-dev-sandbox]
    uses: ./.github/workflows/deploy-backend.yml
    with:
      apigee_environment: ${{ matrix.apigee_environment_name }}
      create_mns_subscription: true
      environment: dev
      sub_environment: pr-${{github.event.pull_request.number}}
