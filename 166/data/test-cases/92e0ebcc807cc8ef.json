{"uid":"92e0ebcc807cc8ef","name":"Verify that the GET method of Search API will be successful with all the valid parameters","fullName":"features.APITests.steps.test_search_steps#test_verify_that_the_get_method_of_search_api_will_be_successful_with_all_the_valid_parameters","historyId":"eb1a00b8d566656712d548382c045544","time":{"start":1769433601546,"stop":1769433603824,"duration":2278},"description":"/home/runner/work/immunisation-fhir-api/immunisation-fhir-api/tests/e2e_automation/features/APITests/search.feature: Verify that the GET method of Search API will be successful with all the valid parameters","descriptionHtml":"<p>/home/runner/work/immunisation-fhir-api/immunisation-fhir-api/tests/e2e_automation/features/APITests/search.feature: Verify that the GET method of Search API will be successful with all the valid parameters</p>\n","status":"failed","statusMessage":"AssertionError: <html>\r\n<head><title>403 Forbidden</title></head>\r\n<body>\r\n<center><h1>403 Forbidden</h1></center>\r\n</body>\r\n</html>","statusTrace":"self = <HookCaller 'pytest_bdd_after_scenario'>\nkwargs = {'feature': Feature(scenarios=OrderedDict([('Verify that the GET method of Search API will be successful with all the ...e, scenario=None, background=None)], description='', tags={'Delete_cleanUp', 'smoke', 'supplier_name_TPP'}, rule=None)}\nfirstresult = False\n\n    def __call__(self, **kwargs: object) -> Any:\n        \"\"\"Call the hook.\n    \n        Only accepts keyword arguments, which should match the hook\n        specification.\n    \n        Returns the result(s) of calling all registered plugins, see\n        :ref:`calling`.\n        \"\"\"\n        assert not self.is_historic(), (\n            \"Cannot directly call a historic hook - use call_historic instead.\"\n        )\n        self._verify_all_args_are_provided(kwargs)\n        firstresult = self.spec.opts.get(\"firstresult\", False) if self.spec else False\n        # Copy because plugins may register other plugins during iteration (#438).\n>       return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n\n/home/runner/.cache/pypoetry/virtualenvs/e2e-automation-vB3pK5nq-py3.11/lib/python3.11/site-packages/pluggy/_hooks.py:512: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n/home/runner/.cache/pypoetry/virtualenvs/e2e-automation-vB3pK5nq-py3.11/lib/python3.11/site-packages/pluggy/_manager.py:120: in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\nfeatures/conftest.py:121: in pytest_bdd_after_scenario\n    context = request.getfixturevalue(\"context\")\n/home/runner/.cache/pypoetry/virtualenvs/e2e-automation-vB3pK5nq-py3.11/lib/python3.11/site-packages/_pytest/fixtures.py:532: in getfixturevalue\n    fixturedef = self._get_active_fixturedef(argname)\n/home/runner/.cache/pypoetry/virtualenvs/e2e-automation-vB3pK5nq-py3.11/lib/python3.11/site-packages/_pytest/fixtures.py:617: in _get_active_fixturedef\n    fixturedef.execute(request=subrequest)\n/home/runner/.cache/pypoetry/virtualenvs/e2e-automation-vB3pK5nq-py3.11/lib/python3.11/site-packages/_pytest/fixtures.py:1071: in execute\n    raise exc.with_traceback(exc_tb)\n/home/runner/.cache/pypoetry/virtualenvs/e2e-automation-vB3pK5nq-py3.11/lib/python3.11/site-packages/_pytest/fixtures.py:1140: in pytest_fixture_setup\n    result = call_fixture_func(fixturefunc, request, kwargs)\n/home/runner/.cache/pypoetry/virtualenvs/e2e-automation-vB3pK5nq-py3.11/lib/python3.11/site-packages/_pytest/fixtures.py:898: in call_fixture_func\n    fixture_result = fixturefunc(**kwargs)\nfeatures/conftest.py:112: in context\n    get_tokens(ctx, ctx.supplier_name)\nutilities/api_gen_token.py:86: in get_tokens\n    context.token = get_access_token(context)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\ncontext = <utilities.context.ScenarioContext object at 0x7f1595baf350>\n\n    def get_access_token(context):\n        login_session = requests.session()\n        client_id = context.auth_client_Id\n        client_secret = context.auth_client_Secret\n        callback_url = context.callback_url\n        username = context.username\n        auth_url = context.auth_url\n        token_url = context.token_url\n        scope = context.scope\n    \n        # Login Page\n        authorize_resp = login_session.get(\n            auth_url,\n            params={\n                \"client_id\": client_id,\n                \"redirect_uri\": callback_url,\n                \"response_type\": \"code\",\n                \"scope\": scope,\n                \"state\": str(uuid.uuid4()),\n            },\n        )\n        assert authorize_resp.status_code == 200, authorize_resp.text\n    \n        # Submit the login form\n        tree = html.fromstring(authorize_resp.content.decode())\n        auth_form = tree.forms[0]\n        form_url = auth_form.action\n        form_data = {\"username\": username}\n        code_resp = login_session.post(url=form_url, data=form_data)\n>       assert code_resp.status_code == 200, code_resp.text\nE       AssertionError: <html>\r\nE       <head><title>403 Forbidden</title></head>\r\nE       <body>\r\nE       <center><h1>403 Forbidden</h1></center>\r\nE       </body>\r\nE       </html>\n\nutilities/api_gen_token.py:47: AssertionError","flaky":false,"newFailed":true,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"setup_environment","time":{"start":1769433482015,"stop":1769433482015,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"global_context","time":{"start":1769433482018,"stop":1769433484402,"duration":2384},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"temp_apigee_apps","time":{"start":1769433484402,"stop":1769433493754,"duration":9352},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_pytest_bdd_example","time":{"start":1769433634647,"stop":1769433634647,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"testStage":{"description":"/home/runner/work/immunisation-fhir-api/immunisation-fhir-api/tests/e2e_automation/features/APITests/search.feature: Verify that the GET method of Search API will be successful with all the valid parameters","status":"failed","statusMessage":"AssertionError: <html>\r\n<head><title>403 Forbidden</title></head>\r\n<body>\r\n<center><h1>403 Forbidden</h1></center>\r\n</body>\r\n</html>","statusTrace":"self = <HookCaller 'pytest_bdd_after_scenario'>\nkwargs = {'feature': Feature(scenarios=OrderedDict([('Verify that the GET method of Search API will be successful with all the ...e, scenario=None, background=None)], description='', tags={'Delete_cleanUp', 'smoke', 'supplier_name_TPP'}, rule=None)}\nfirstresult = False\n\n    def __call__(self, **kwargs: object) -> Any:\n        \"\"\"Call the hook.\n    \n        Only accepts keyword arguments, which should match the hook\n        specification.\n    \n        Returns the result(s) of calling all registered plugins, see\n        :ref:`calling`.\n        \"\"\"\n        assert not self.is_historic(), (\n            \"Cannot directly call a historic hook - use call_historic instead.\"\n        )\n        self._verify_all_args_are_provided(kwargs)\n        firstresult = self.spec.opts.get(\"firstresult\", False) if self.spec else False\n        # Copy because plugins may register other plugins during iteration (#438).\n>       return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)\n\n/home/runner/.cache/pypoetry/virtualenvs/e2e-automation-vB3pK5nq-py3.11/lib/python3.11/site-packages/pluggy/_hooks.py:512: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n/home/runner/.cache/pypoetry/virtualenvs/e2e-automation-vB3pK5nq-py3.11/lib/python3.11/site-packages/pluggy/_manager.py:120: in _hookexec\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\nfeatures/conftest.py:121: in pytest_bdd_after_scenario\n    context = request.getfixturevalue(\"context\")\n/home/runner/.cache/pypoetry/virtualenvs/e2e-automation-vB3pK5nq-py3.11/lib/python3.11/site-packages/_pytest/fixtures.py:532: in getfixturevalue\n    fixturedef = self._get_active_fixturedef(argname)\n/home/runner/.cache/pypoetry/virtualenvs/e2e-automation-vB3pK5nq-py3.11/lib/python3.11/site-packages/_pytest/fixtures.py:617: in _get_active_fixturedef\n    fixturedef.execute(request=subrequest)\n/home/runner/.cache/pypoetry/virtualenvs/e2e-automation-vB3pK5nq-py3.11/lib/python3.11/site-packages/_pytest/fixtures.py:1071: in execute\n    raise exc.with_traceback(exc_tb)\n/home/runner/.cache/pypoetry/virtualenvs/e2e-automation-vB3pK5nq-py3.11/lib/python3.11/site-packages/_pytest/fixtures.py:1140: in pytest_fixture_setup\n    result = call_fixture_func(fixturefunc, request, kwargs)\n/home/runner/.cache/pypoetry/virtualenvs/e2e-automation-vB3pK5nq-py3.11/lib/python3.11/site-packages/_pytest/fixtures.py:898: in call_fixture_func\n    fixture_result = fixturefunc(**kwargs)\nfeatures/conftest.py:112: in context\n    get_tokens(ctx, ctx.supplier_name)\nutilities/api_gen_token.py:86: in get_tokens\n    context.token = get_access_token(context)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\ncontext = <utilities.context.ScenarioContext object at 0x7f1595baf350>\n\n    def get_access_token(context):\n        login_session = requests.session()\n        client_id = context.auth_client_Id\n        client_secret = context.auth_client_Secret\n        callback_url = context.callback_url\n        username = context.username\n        auth_url = context.auth_url\n        token_url = context.token_url\n        scope = context.scope\n    \n        # Login Page\n        authorize_resp = login_session.get(\n            auth_url,\n            params={\n                \"client_id\": client_id,\n                \"redirect_uri\": callback_url,\n                \"response_type\": \"code\",\n                \"scope\": scope,\n                \"state\": str(uuid.uuid4()),\n            },\n        )\n        assert authorize_resp.status_code == 200, authorize_resp.text\n    \n        # Submit the login form\n        tree = html.fromstring(authorize_resp.content.decode())\n        auth_form = tree.forms[0]\n        form_url = auth_form.action\n        form_data = {\"username\": username}\n        code_resp = login_session.post(url=form_url, data=form_data)\n>       assert code_resp.status_code == 200, code_resp.text\nE       AssertionError: <html>\r\nE       <head><title>403 Forbidden</title></head>\r\nE       <body>\r\nE       <center><h1>403 Forbidden</h1></center>\r\nE       </body>\r\nE       </html>\n\nutilities/api_gen_token.py:47: AssertionError","steps":[],"attachments":[{"uid":"62da4fd7cb36cc10","name":"Step Failed: Valid vaccination record is created with Patient 'Mod11_NHS' and vaccine_type 'RSV'","source":"62da4fd7cb36cc10.txt","type":"text/plain","size":232}],"parameters":[],"stepsCount":0,"shouldDisplayMessage":true,"attachmentsCount":1,"hasContent":true,"attachmentStep":false},"afterStages":[{"name":"temp_apigee_apps::0","time":{"start":1769433864306,"stop":1769433877832,"duration":13526},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"shouldDisplayMessage":false,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"labels":[{"name":"epic","value":"Immunization Service"},{"name":"suite","value":"Search the immunization of a patient"},{"name":"feature","value":"Search the immunization of a patient"},{"name":"tag","value":"Delete_cleanUp"},{"name":"tag","value":"smoke"},{"name":"tag","value":"functional"},{"name":"tag","value":"Search_Feature"},{"name":"tag","value":"supplier_name_TPP"},{"name":"parentSuite","value":"features.APITests.steps"},{"name":"host","value":"runnervmymu0l"},{"name":"thread","value":"2779-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"features.APITests.steps.test_search_steps"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"_pytest_bdd_example","value":"{'Patient': 'Mod11_NHS', 'Vaccine_type': 'RSV'}"}],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[],"flaky":false}],"history":{"statistic":{"failed":1,"broken":0,"skipped":0,"passed":6,"unknown":0,"total":7},"items":[{"uid":"a529be74d808b87c","reportUrl":"https://NHSDigital.github.io/immunisation-fhir-api/166/#testresult/a529be74d808b87c","status":"passed","time":{"start":1769432947438,"stop":1769432949379,"duration":1941}},{"uid":"af61774370a6b58f","reportUrl":"https://NHSDigital.github.io/immunisation-fhir-api/1159/#testresult/af61774370a6b58f","status":"passed","time":{"start":1769427118564,"stop":1769427121255,"duration":2691}},{"uid":"1843367ed36d78bd","reportUrl":"https://NHSDigital.github.io/immunisation-fhir-api/165/#testresult/1843367ed36d78bd","status":"passed","time":{"start":1769425033055,"stop":1769425035883,"duration":2828}},{"uid":"d8e0ce5cb3f579fd","reportUrl":"https://NHSDigital.github.io/immunisation-fhir-api/165/#testresult/d8e0ce5cb3f579fd","status":"passed","time":{"start":1769424376360,"stop":1769424378286,"duration":1926}},{"uid":"db3ef0aea969c7af","reportUrl":"https://NHSDigital.github.io/immunisation-fhir-api/1158/#testresult/db3ef0aea969c7af","status":"passed","time":{"start":1769423387414,"stop":1769423389671,"duration":2257}},{"uid":"14e51e20fa91dfbd","reportUrl":"https://NHSDigital.github.io/immunisation-fhir-api/1158/#testresult/14e51e20fa91dfbd","status":"passed","time":{"start":1769422866556,"stop":1769422868914,"duration":2358}}]},"tags":["Search_Feature","functional","supplier_name_TPP","smoke","Delete_cleanUp"]},"source":"92e0ebcc807cc8ef.json","parameterValues":["{'Patient': 'Mod11_NHS', 'Vaccine_type': 'RSV'}"]}